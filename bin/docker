#!/usr/bin/env bash
set -ex
fail() { echo "FAIL: $*" >&2 ; exit 1; }

cmd="$1"

shift ||
  fail "Usage: $0: {stop,build,start}"

export VAULT_DATA_PREFIX="secret/data/exodus/"
export VAULT_LIST_PREFIX="secret/metadata/exodus/"
export VAULT_ADDR="https://10.128.4.5:443"
export VAULT_SKIP_VERIFY="true"
export VAULT_TOKEN="$(cat ~/.vault-token)"
export CLIENT_ID="cfa78f27867826309fb6"
export CLIENT_SECRET="27c5646e9c70d276c4b487fa9f5d17366f31f2b1"

case "${cmd}" in
  (compose-build)
    docker compose build
    ;;
  (compose-up)
    docker compose up --detach
    ;;
  (compose-stop)
    docker compose stop
    ;;
esac
